<!DOCTYPE html>
<html>
    <head>
        <title>EvAccum</title>
        <script src="jspsych-6.1.0/jspsych.js"></script>
        <script src="jspsych-6.1.0/plugins/jspsych-html-keyboard-response.js"></script>
		<script src="jspsych-6.1.0/plugins/jspsych-image-keyboard-response.js"></script>
		<script src="jspsych-6.1.0/plugins/jspsych-external-html.js"></script>
		<script src="jspsych-6.1.0/plugins/jspsych-rdk.js"></script>
        <link href="jspsych-6.1.0/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    </head>
    <body></body>
    <script>

		/* initialise timeline array */
        var timeline =[];

		/* start screen */
		var startscreen = {
			type: "html-keyboard-response",
            stimulus: "Press any key to begin."
        };
		timeline.push(startscreen);

		/* instructions */
		var instructions = {
			type: "external-html",
			url: "instructions/pg-1.html"
			post_trial_gap: 1000,
		};
		timeline.push(instructions);

		/* array with stimuli */
		var stimuli = [
			{stimulus: "stimuli/arrows_cue_with_line.png", data: {test_part: 'test', correct_response: 'f'}},
		];

		/* fixation */
		var fixation = {
			type: 'html-keyboard-response',
			stimulus: '<div style="font-size:60px;">+</div>',
			choices: jsPsych.NO_KEYS,
			trial_duration: 300,
			data: {test_part: 'fixation'},
		};
		

		/* trial type */
		var trial = {
			type: 'image-keyboard-response',
			stimulus: jsPsych.timelineVariable('stimulus'),
			choices: ['a', 's'],
			data: jsPsych.timelineVariable('data'),
			on_finish: function(data) {
				data.correct = data.key_press == jsPsych.pluginAPI.convertKeyCharacterToKeyCode(data.correct_response);
			},
		};


		/* push the fixation and trial info to the timeline as a mini timeline */
		var procedure = {
			timeline: [fixation, trial],
			timeline_variables: stimuli,
			repetitions: 5,
		};
		timeline.push(procedure);

		/* provide feedback */
		var feedback = {
			type: "html-keyboard-response",
			stimulus: function() {
				var trials = jsPsych.data.get().filter({test_part:'test'});
				var correct_trials = trials.filter({correct:true});
				var accuracy = Math.round(correct_trials.count()/trials.count()*100);
				var rt = Math.round(correct_trials.select('rt').mean());

				return "<p>You responded correctly on "+accuracy+"% of the trials.</p>"+
					"<p>Your average reaction time was "+rt+"ms.</p>"+
					"<p>Press any key to continue</p>";
			},
		};
		timeline.push(feedback);
		
		/* initialise experiment */
        jsPsych.init({
            timeline: timeline,
			on_finish: function() {
				jsPsych.data.displayData();
			},
        });

    </script>
</html>
